# Лабораторная работа №1

## Задания:

Настроить nginx по заданному тз:
1. Должен работать по https c сертификатом
2. Настроить принудительное перенаправление HTTP-запросов (порт 80) на HTTPS (порт 443) для обеспечения безопасного соединения.
3. Использовать alias для создания псевдонимов путей к файлам или каталогам на сервере.
4. Настроить виртуальные хосты для обслуживания нескольких доменных имен на одном сервере.

## Установка NGINX

> Перед началом уточним, что работаем мы на ОС **Ubuntu 24.04 LTS**. Теперь можем начинать!

* Открываем терминал и при помощи команды `sudo apt-get install nginx` устанавливаем NGINX.  
* Если нас просят продолжить - соглашаемся.  
* NGINX установлен!  

* После установки проверяем статус работы NGINX при помощи команды `sudo systemctl status nginx`.

![Снимок экрана от 2024-10-08 16-20-18](https://github.com/user-attachments/assets/917b1a5b-bbd9-42d6-bef4-9497f649999d)

* Если статус **inactive (dead)**, запустите NGINX вручную с помощью команды `sudo systemctl start nginx`.  
* NGINX автоматически запускается во время загрузки сервера.  
* Чтобы отключить автозапуск, введите `sudo systemctl disable nginx`.  
* Чтобы возобновить автозапуск сервиса, введите `sudo systemctl enable nginx`.
* Также проверим работу нашего NGINX с локального хоста.

![Снимок экрана от 2024-10-08 16-28-17](https://github.com/user-attachments/assets/007365e4-b0bc-4f4c-81c5-dca32b0b05af)

## Настройка виртуальных хостов

* Прежде чем создать виртуальный хост, нужно создать директорию для сайта, в которой будут размещены все необходимые файлы. По умолчанию в Ubuntu включен один виртуальный хост NGINX, который обслуживает документы из каталога `/var/www/html`. Чтобы добавить еще один домен, необходимо создать директорию в `/var/www`.
* Создадим директории для наших сайтов при помощи команд `sudo mkdir -p /var/www/Site1.com/html` и `sudo mkdir -p /var/www/Site2.com/html`. Контент для сайтов мы добавим чуть позже.
* А теперь давайте перейдем к директории `/etc/nginx/sites-available`, где создадим файлы-конфигурвции для наших сайтов. При помощи команды `sudo nano /etc/nginx/sites-available/Site1.com.conf` создаем файл-конфигурацию для нашего сайта и сразу же настраиваем его. По аналогии проделываем те же операции для второго сайта.

![Снимок экрана от 2024-10-09 13-39-55](https://github.com/user-attachments/assets/3d8577e6-cec2-4d38-be9f-1378e3f3ccc4)

* В первом блоке **server** мы прописали: `listen 80;` - что сервер ждет запорсы пользователей на порту `80`, `server_name Site1.com;` - теперь веб-сервер будет ожидать запросы, адрисованные к этому домену, `location /` - `root /var/www/...;` - путь к файлам сайта. Когда придет запрос, NGINX будет искать файлы для сайта в этой дериктории/ `index index.html;` - название главного html файла (его мы добавим чуть позже). `return 301 https://...;` - редирект с http на https соединение.
* Второй блок **server** отличается лишь тем что мы добавили две новые строчки, отвечающие за безопасное соединение с сервером по ssl. Сами ключи и сертификаты мы добави чуть позже.

* Давайте также для удобства тестирования сделаем следующее. Откроем файл `/etc/hosts` и присвоим нашим доменам IP-адресс локального хоста.

![Снимок экрана от 2024-10-09 13-38-38](https://github.com/user-attachments/assets/79c66a5f-de54-4e01-9918-f7af60041c39)

## Добавление контента

* Создадим для наших сайтов **index.html** файлы при помощи команды `sudo nano /var/www/Site1.com/html/index.html` для первого сайта, `sudo nano /var/www/Site2.com/html/index.html` - для второго. Пример верстки:
```
<html>
    <head>
        <title>Site1</title>
    </head>
    <body>
        <h1>Success! {Site1}</h1>
    </body>
</html>
```
## SSL

* Как мы и обещали раньше, займемся вопросом SSL-сертификатов. Пойдем по пути наименьшего сопротивления и создадим самоподписанные сертифкаты при помощи утилиты OpenSSL. Следуем шагам
* Шаг 1 - устанавливаем нашу утилиту
  ```
  sudo apt update
  sudo apt install openssl
  ```
* Шаг 2 - Создаем самоподписный сертификат и приватный ключ. Описывать что значит каждый из параметров не видем смысла, поэтому остановимся на самых важных `-keyout` - куда сохраняем приватный ключ, `-out` - куда сохраняем сертификат.
```
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/ssl/mycerts/mykey.key \
  -out /etc/ssl/mycerts/mycert.crt
```
* Шаг 3 - вовзращаемся к файлу конфигуратору и прописываем пути к нашему ключу и сертификату.

![Снимок экрана от 2024-10-09 13-39-00](https://github.com/user-attachments/assets/3c8b18c2-5297-4638-af46-3e314f7ed90f)

## Проверяем работу нашего веб-сервера

* Активируем виртуальный хост - `sudo ln -s /etc/nginx/sites-available/Site1.com.conf /etc/nginx/sites-enabled/` (то же самое для второго сервера).
* Проверяем конфигурацию - `sudo nginx -t`.
* Если нет ошибок, то перезапускаем NGINX - `sudo systemctl reload nginx`.

![image](https://github.com/user-attachments/assets/a5e84008-968c-428e-aeb5-9143bcbbb3c8)
